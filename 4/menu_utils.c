#include "menu_utils.h"
#include <ctype.h>
#include <string.h>

void show_menu()
{
    printf("\n=== Меню ===\n");
    printf("1. Использовать статический массив для реализации стека\n");
    printf("2. Использовать динамический массив для реализации стека\n");
    printf("3. Использовать стек-список для реализации стека\n");
    printf("4. Замеры времени\n");
    printf("5. Сравнение эффективности реализаций стека\n");
    printf("0. Выход\n");
    printf("Выберите тип пункт: ");
}

void show_operations(int is_list)
{
    printf("\n--- Операции ---\n");
    printf("1. Добавить элемент\n");
    printf("2. Удалить элемент\n");
    printf("3. Ввести выражение и вычислить\n");
    printf("4. Показать стек\n");
    printf("5. Показать объём памяти стека\n");
    printf("6. Очистить текущий стек\n");
    if (is_list)
        printf("7. Показать список освобождённых адресов (только список)\n");
    printf("0. Назад\n");
}

int validate_expression(const char *expr)
{
    int len = (int)strlen(expr);
    if (len == 0)
        return 0; // пустая строка
    // первый символ должен быть цифрой
    if (!isdigit((unsigned char)expr[0]))
        return 0;
    int i = 0;
    while (i < len)
    {
        // должно идти число
        if (!isdigit((unsigned char)expr[i]))
            return 0;
        // читаем число
        int num = 0;
        while (i < len && isdigit((unsigned char)expr[i]))
        {
            num = num * 10 + (expr[i] - '0');
            i++;
        }
        // проверка деления на 0
        if (i < len && expr[i] == '/')
        {
            if (i + 1 < len)
            {
                int j = i + 1;
                int next_num = 0;
                if (!isdigit((unsigned char)expr[j]))
                    return 0; // после / должно быть число
                while (j < len && isdigit((unsigned char)expr[j]))
                {
                    next_num = next_num * 10 + (expr[j] - '0');
                    j++;
                }
                if (next_num == 0)
                    return 0; // деление на 0
            }
            else
            {
                return 0; // / в конце строки
            }
        }
        // после числа может идти оператор или конец строки
        if (i < len)
        {
            if (expr[i] != '+' && expr[i] != '-' && expr[i] != '*' && expr[i] != '/')
                return 0;
            i++; // переходим к следующему числу
            if (i == len)
                return 0; // строка не может заканчиваться оператором
        }
    }
    return 1;
}

void read_expression(char *buffer, int size)
{
    printf("Введите арифметическое выражение:\n");
    fgets(buffer, size, stdin);
    size_t len = strlen(buffer);
    if (len > 0 && buffer[len - 1] == '\n')
    {
        buffer[len - 1] = '\0';
    }
}

void show_info(void)
{
    printf("\n\n=======================================================================");
    printf("\n\nПрограмма реализует работу со стеком\n");
    printf("Стек может быть реализован в качестве: \n");
    printf("1. Статичекого массива\n");
    printf("2. Динамического массива\n");
    printf("3. Списка\n");
    printf("\nРеализованы следующие функции:\n");
    printf("1. Pop\n2. Push\n3. Вычисление выражения с приоритетом\n");
    printf("4. Вывод содержимого массива\n5. Вывод использованной памяти\n");
    printf("6. Очистка стека\n7. Вывод списка очищенных адресов (только для списка)\n");
    printf("\n");
    printf("Так же в программе реализованы замеры времени для разных реализаций стека:\n");
    printf("A. Комплексные замеры\n");
    printf("Выводится время, для всех реализаций стека, которое необходимо для выполнения следующих функций по 100 тысяч раз\n");
    printf("1. Pop\n2. Push\n3. Подсчёт выражения (1*2+3*4+5*6+7*8+9)\n\n");
    printf("Б. Сравнение времени, в %% и в разах, для динамического стека и списка-стека oтносительно реализации стека на статическом массиве\n");
    printf("Для следующих оперций: \n1. Push\n2. Pop\n3. Подсчёт выражения (1*2+3*4+5*6+7*8+9)\nЗамеры проводятся для 100, 1000, 10000 элементов. Каждый замер проводится по 100 тысяч раз");

    printf("\n\n=======================================================================");
    printf("\n");
}